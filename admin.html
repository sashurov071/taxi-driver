<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taxi Admin Pro</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg: #F4F5F9; --white: #FFF; --text: #111827; --primary: #E11D48; /* Pushti */
            --radius: 20px; --shadow: 0 4px 20px rgba(0,0,0,0.03);
        }
        body { background: var(--bg); font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* SIDEBAR */
        .sidebar { width: 260px; background: var(--white); padding: 25px; display: flex; flex-direction: column; border-right: 1px solid #eee; }
        .brand { font-size: 24px; font-weight: 800; color: var(--primary); margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .menu-item { padding: 12px 15px; border-radius: 12px; color: #6B7280; font-weight: 600; cursor: pointer; margin-bottom: 5px; transition: 0.2s; display: flex; align-items: center; gap: 10px; }
        .menu-item:hover, .menu-item.active { background: #FFF0F3; color: var(--primary); }

        /* MAIN */
        .main { flex: 1; padding: 30px; overflow-y: auto; position: relative; }
        .header { display: flex; justify-content: space-between; margin-bottom: 30px; }
        
        /* TABS (Views) */
        .view-section { display: none; height: 100%; }
        .view-section.active { display: block; }

        /* CARDS */
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 20px; }
        .card { background: var(--white); border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow); }
        .stat-val { font-size: 28px; font-weight: 800; margin: 5px 0; }
        
        /* MAP CONTAINER */
        #map { width: 100%; height: 500px; border-radius: var(--radius); box-shadow: var(--shadow); }
        
        /* DRIVER LIST */
        .driver-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; }
        .online { background: #34c759; }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="brand"><i class="fa-solid fa-taxi"></i> TaxiPro</div>
        <div class="menu-item active" onclick="switchTab('dashboard', this)"><i class="fa-solid fa-chart-pie"></i> Dashboard</div>
        <div class="menu-item" onclick="switchTab('map', this)"><i class="fa-solid fa-map"></i> Live Map</div>
        <div class="menu-item" onclick="switchTab('finance', this)"><i class="fa-solid fa-wallet"></i> Moliya</div>
    </nav>

    <main class="main">
        <div class="header">
            <div>
                <h1 style="font-size:24px; font-weight:800;">Admin Panel</h1>
                <p style="color:#666;">Xush kelibsiz, Boss!</p>
            </div>
            <img src="https://ui-avatars.com/api/?name=Admin&background=E11D48&color=fff" style="width:40px; height:40px; border-radius:50%;">
        </div>

        <div id="view-dashboard" class="view-section active">
            <div class="grid-4">
                <div class="card">
                    <div style="color:#666; font-size:13px;">Jami Tushum</div>
                    <div class="stat-val">$528,976</div>
                </div>
                <div class="card" style="background:#111827; color:white;">
                    <div style="opacity:0.7; font-size:13px;">Faol Haydovchilar</div>
                    <div class="stat-val">12 ta</div>
                </div>
            </div>
            <h3 style="margin-bottom:15px;">Muborak Jonli Xaritasi</h3>
            <div id="map"></div>
        </div>

        <div id="view-finance" class="view-section">
            <div class="card">
                <h3>Depozit So'rovlari</h3>
                <p>Hozircha yangi so'rovlar yo'q...</p>
            </div>
        </div>
    </main>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // TABS
        function switchTab(viewId, el) {
            document.querySelectorAll('.view-section').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(d => d.classList.remove('active'));
            document.getElementById('view-' + viewId).classList.add('active');
            el.classList.add('active');
            
            // Xarita o'lchamini to'g'irlash (Leaflet bug)
            setTimeout(() => { map.invalidateSize(); }, 100);
        }

        // MAP SETUP
        var map = L.map('map').setView([39.2618, 65.1522], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        
        L.circle([39.2618, 65.1522], {
            color: '#E11D48', fillColor: '#E11D48', fillOpacity: 0.1, radius: 15000
        }).addTo(map);

        // LIVE DRIVERS FETCH
        async function updateMap() {
            try {
                // Localhostdagi botdan data olamiz
                let res = await fetch('http://localhost:8080/api/drivers');
                let drivers = await res.json();
                
                // Markerlarni tozalab yangisini chizamiz (Soddalashtirilgan)
                // Real loyihada marker.setLatLng() ishlatiladi
                drivers.forEach(d => {
                    L.marker([d.lat, d.lon]).addTo(map)
                        .bindPopup(`<b>${d.name}</b><br>${d.car}`);
                });
            } catch(e) { console.log("Server off"); }
        }
        setInterval(updateMap, 5000);
    </script>
</body>
</html>
